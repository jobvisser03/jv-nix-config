# sops-nix configuration
# See: https://github.com/Mic92/sops-nix

keys:
  # Host keys - convert SSH host key to age format:
  # ssh-keyscan <hostname> 2>/dev/null | grep ed25519 | ssh-to-age
  #
  # To get larkbox's key:
  # ssh-keyscan larkbox.local 2>/dev/null | grep ed25519 | ssh-to-age
  - &larkbox age1pgyawfqrlvzwks4y2dq2u486lyz47qwu3uyt5ftazn3at70pxs0q9xwj6u

  # Mac Intel NixOS host key
  # Run: ssh-keyscan job-mac-nixos 2>/dev/null | grep ed25519 | ssh-to-age
  - &mac_intel_nixos age1ughl3lhzhd07xw7xsrhk6zdzlqtg40mzeftu08pdv9c4vml5556qld9znq

  # Personal key for editing secrets (not for host decryption)
  - &personal age188usuuflnprxceyxxa4c79hgajgyzjzsuwrlpn0rntdfm4ujsv2swfx743

  # Add more hosts here as needed:
  # - &newhost age1yyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy

creation_rules:
  # Larkbox-specific secrets
  - path_regex: secrets/larkbox\.yaml$
    key_groups:
      - age:
          - *larkbox
          - *personal

  # Mac Intel NixOS-specific secrets
  - path_regex: secrets/mac-intel-nixos\.yaml$
    key_groups:
      - age:
          - *mac_intel_nixos
          - *personal

  # Shared secrets (all hosts can decrypt)
  # Add more host keys here when you have multiple hosts
  - path_regex: secrets/shared\.yaml$
    key_groups:
      - age:
          - *larkbox
          - *personal
          - *mac_intel_nixos
